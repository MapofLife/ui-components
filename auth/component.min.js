/*! 2015-08-17 */
angular.module("mol-auth-templates",[]).run(["$templateCache",function($templateCache){$templateCache.put("mol-auth-control.html",'<div ng-show="!user && init" ng-click=molAuthLoginModal() class=clickable>login/register</div><div ng-show=user dropdown dropdown-append-to-body>Logged&nbsp;in&nbsp;as:&nbsp;<a class=clickable dropdown-toggle>{{user.fullname}} <span class=caret></span></a><ul role=menu class="dropdown-menu dropdown-menu-right"><li><a class=clickable href=https://auth.mol.org/profile>Profile</a></li><li><a class=clickable href=https://auth.mol.org/dashboard>Dashboard</a></li><li><a class=clickable ng-click=logout()>Log out</a></li></ul></div>'),$templateCache.put("mol-auth-modal.html",'<div class=modal-header><button type=button class=close ng-click=close()><span aria-hidden=true>Ã—</span><span class=sr-only>Close</span></button><h3 class=omb_authTitle><a ng-click="register=0" class=clickable>Login</a> or <a href=https://auth.mol.org/register class=clickable>Sign up</a></h3></div><div class=modal-body><div ng-show=!register class=well><div class=omb_login><div class="row omb_row-sm-offset-3"><div class=col-xs-12><form class=omb_loginForm name=login_user_form action=/login autocomplete=off method=POST><div class=input-group><span class=input-group-addon><i class="fa fa-user"></i></span> <input class=form-control id=email name=email placeholder="Email address" ng-model=email></div><span class=help-block></span><div class=input-group><span class=input-group-addon><i class="fa fa-lock"></i></span> <input class=form-control id=password name=password placeholder=Password type=password ng-model=password></div><span class=help-block></span> <input type=hidden name=remember value=yes></form><button class="btn btn-lg btn-primary btn-block" ng-click=login()>Login</button></div></div><div class="row omb_row-sm-offset-3"><div class="col-xs-12 col-sm-12"><input type=checkbox ng-model=remember>&nbsp;&nbsp;Remember&nbsp;Me</div><div class="col-xs-12 col-sm-12"><p class=omb_forgotPwd><a href=https://auth.mol.org/reset>Forgot&nbsp;password?</a></p></div></div></div></div></div>')}]),angular.module("mol.auth",["mol-auth-templates"]).factory("molAuthLoginModal",["$modal","$cookies",function($modal,$cookies){return function(){$modal.open({templateUrl:"mol-auth-modal.html",size:"sm",controller:function($scope,$modalInstance){$scope.login=function(){$http({url:"https://auth.mol.org/api/login/cors",method:"POST",headers:{"Content-Type":"application/json"},ignoreLoadingBar:!1,data:{email:$scope.email,password:$scope.password,remember:$scope.remember?"yes":"no"},withCredentials:!1}).then(function(response){console.log(response),$cookies.put("muprsns",response.data.authtoken,{path:"/",domain:".mol.org"}),$scope.close()})},$scope.close=function(){$modalInstance.dismiss("cancel")},$scope.location=$location.absUrl()}})}}]).directive("molAuth",["$state","$q","$timeout","$cookies","$modal","$location","$http",function($state,$q,$timeout,$cookies,$modal,$location,$http){return{restrict:"E",require:"",scope:{user:"=user"},templateUrl:"mol-auth-control.html",controller:function($scope,$q,$state,$timeout,$cookies,$modal,$location){$scope.init=void 0,$scope.getUser=function(){if($cookies.get("muprsns"))try{$http({url:"https://auth.mol.org/api/me",method:"GET",params:{auth_token:$cookies.get("muprsns")},withCredentials:!1}).then(function(response){console.log(response),response.data.fullname&&($scope.user=response.data,$scope.init=!0)})}catch(e){$scope.init=!0}else $scope.init=!0},$scope.logout=function(){$cookies.remove("muprsns",{path:"/",domain:".mol.org"}),delete $scope.user},$scope.$watch(function(){return $cookies.get("muprsns")},function(newValue,oldValue){newValue&&$scope.getUser()}),$scope.loginModal=function(){$modal.open({templateUrl:"mol-auth-modal.html",size:"sm",controller:function($scope,$modalInstance){$scope.login=function(){$http({url:"https://auth.mol.org/api/login/cors",method:"POST",headers:{"Content-Type":"application/json"},ignoreLoadingBar:!1,data:{email:$scope.email,password:$scope.password,remember:$scope.remember?"yes":"no"},withCredentials:!1}).then(function(response){console.log(response),$cookies.put("muprsns",response.data.authtoken,{path:"/",domain:".mol.org"}),$scope.close()})},$scope.close=function(){$modalInstance.dismiss("cancel")},$scope.location=$location.absUrl()}})},$scope.getUser()}}}]);