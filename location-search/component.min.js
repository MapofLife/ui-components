/*! 2016-06-29 */
angular.module("mol-location-search-templates",["mol-location-search-autocomplete.html","mol-location-search-control.html"]),angular.module("mol-location-search-autocomplete.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("mol-location-search-autocomplete.html",'<script type=text/ng-template id=ac-region-template.html><a class="searchResult">\n	    <span class="commonName" ng-bind-html="match.label.name | uibTypeaheadHighlight:query"></span>\n	</a></script><input class=form-control autocomplete=on ng-show=regions.available ng-model=regions.selected.name placeholder="Search for a region" uib-typeahead="region for region in regions.available | filter:$viewValue | limitTo:50" typeahead-on-select=selectRegion($model) typeahead-template-url=ac-region-template.html>')}]),angular.module("mol-location-search-control.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("mol-location-search-control.html","<table class=search><tr><td><span class=form-group><div ng-include=\"'mol-location-search-autocomplete.html'\"></div></span></td></tr></table>")}]),angular.module("mol.location-search",["mol-location-search-templates"]).directive("molLocationSearch",["molApi","$state","$q",function(molApi,$state,$q){return{restrict:"E",scope:!1,transclude:!1,templateUrl:"mol-location-search-control.html",controller:function($scope,$state){$scope.canceller=$q.defer(),$scope.regionTypes={selected:void 0,available:[]},$scope.regions={available:[],selected:void 0},molApi({canceller:$scope.canceller,loading:!0,service:"spatial/regions/types",creds:!0}).then(function(response){$scope.regionTypes.available=response.data,angular.forEach(response.data,function(type){try{type.type.toLowerCase()===$state.params.regiontype.toLowerCase()&&($scope.regionTypes.selected=type)}catch(e){}})}),$scope.selectRegionType=function(type){type&&type.dataset_id&&($state.transitionTo($state.current,{regiontype:type.type},{notify:!1,inherit:!0,reload:!1}),molApi({service:"spatial/regions/list",params:{dataset_id:type.dataset_id},canceller:$scope.canceller,loading:!0}).success(function(response){$scope.regions.available=response,angular.forEach(response,function(region){try{region.name.toLowerCase()===$state.params.region.toLowerCase()&&$scope.selectRegion(region)}catch(e){console.log(e)}})}))},$scope.selectRegion=function(region){$scope.$parent.region=region,$scope.regions.selected=region,$state.transitionTo($state.current,{region:region.name,regiontype:$scope.regionTypes.selected.type},{notify:!1,inherit:!0,reload:!1})},$scope.$watch("regionTypes.selected",function(newValue,oldValue){newValue&&$scope.selectRegionType(newValue)})}}}]);