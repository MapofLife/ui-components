/*! 2015-07-24 */
angular.module("mol-species-search-templates",["mol-species-search-autocomplete.html","mol-species-search-control.html"]),angular.module("mol-species-search-autocomplete.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("mol-species-search-autocomplete.html",'<script type=text/ng-template id=ac-template.html><a class="searchResult">\n		<span class="sciName" bind-html-unsafe="match.label.n | typeaheadHighlight:query"></span>\n	    <span class="commonName" bind-html-unsafe="match.label.v | typeaheadHighlight:query"></span>\n	</a></script><input class=form-control autocomplete=on ng-model=selected.value placeholder="Select a species" typeahead="species.n as species for species in searchSpecies($viewValue)" typeahead-on-select=selectSpecies($model) typeahead-template-url=ac-template.html>')}]),angular.module("mol-species-search-control.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("mol-species-search-control.html",'<table class=search><tr><td><ui-select ng-model=groups.selected><ui-select-match class=group-label placeholder="Select a group...">{{$select.selected.label}}&nbsp;&nbsp;</ui-select-match><ui-select-choices repeat="group in groups.available track by $index"><div ng-bind-unsafe-html="group.label | uppercase"></div><small class=group-label>{{ group.label }}</small></ui-select-choices></ui-select></td><td><span class=form-group><div ng-include="\'mol-species-search-autocomplete.html\'"></div></span></td><td class=hidden-xxs><button type=button ng-click=randomSpecies() class="random top_button btn btn-default">Pick random</button></td></tr></table>')}]),angular.module("mol.species-search",["mol-species-search-templates"]).directive("speciesSearch",["MOLServices","$state","$q",function(MOLServices,$state,$q){return{restrict:"E",scope:!1,transclude:!1,templateUrl:"mol-species-search-control.html",controller:function($scope){$scope.canceller=$q.defer(),$scope.searchSpecies=function(term){return MOLServices("searchspecies",{term:term,group:$scope.groups.selected.value},$scope.canceller,!0).then(function(results){return results.data})},$scope.groups={selected:{},available:[]},MOLServices("availabletaxa",{},$scope.canceller,!1).then(function(results){angular.forEach(results.data,function(result){$scope.groups.available.push({label:result.taxa,value:result.taxa})})}),$scope.selectSpecies=function(scientificname){MOLServices("speciesinfo",{name:scientificname},$scope.canceller,!0).success(function(species){if(void 0!=species){if(void 0!=species.prefs&&void 0!=species.prefs.habitats){for(var bools=[],i=0;17>i;i++)bools.push(!1);species.prefs.habitats.split(",").forEach(function(h){bools[parseInt(h)]=!0}),species.prefs.habitats=bools,100==species.prefs.tree_cover_min&&(species.prefs.tree_cover_min=50)}species.refine={},species.protect={},species.maps={},species.updateMaps=!0,species.habitat={stats:{forest_b1:void 0,forest_b0:void 0,pop_se_b1:void 0,area_se_b1:void 0,area_conf_95_10:[void 0,void 0],pop_b0:void 0,pop_conf_95_10:[void 0,void 0],area_b1:void 0,area_b0:void 0,forest_se_b1:void 0,forest_percent_change:void 0,pop_percent_change:void 0,area_percent_change:void 0,forest_conf_95_10:[void 0,void 0],pop_b1:void 0},area:[[2012,0],[2003,0],[2011,0],[2001,0],[2002,0],[2010,0],[2004,0],[2005,0],[2006,0],[2007,0],[2008,0],[2009,0]],forest:[[2012,0],[2003,0],[2011,0],[2001,0],[2002,0],[2010,0],[2004,0],[2005,0],[2006,0],[2007,0],[2008,0],[2009,0]],pop:[[2012,0],[2003,0],[2011,0],[2001,0],[2002,0],[2010,0],[2004,0],[2005,0],[2006,0],[2007,0],[2008,0],[2009,0]]},$scope.$parent.species=species}})},$scope.randomSpecies=function(){var mode="randomspecies";$scope.selected=void 0,$scope.selected=MOLServices(mode,{group:$scope.groups.selected.value,rand:Math.random()},!0).success(function(species){$scope.selectSpecies(species.n)})},$scope.$watch("species",function(newValue,oldValue){if(newValue){var taxa=newValue.taxa||"Any group";$scope.groups.selected={label:taxa,value:taxa}}}),$state.params.scientificname?$scope.selectSpecies($state.params.scientificname.replace(/_/g," ")):$scope.randomSpecies()}}}]);