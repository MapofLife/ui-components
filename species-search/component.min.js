/*! 2016-08-09 */
!function(){var cssText="mol-species-search{margin-right:80px}mol-species-search .dropdown-menu{margin-left:-180px}",styleEl=document.createElement("style");if(document.getElementsByTagName("head")[0].appendChild(styleEl),styleEl.styleSheet)styleEl.styleSheet.disabled||(styleEl.styleSheet.cssText=cssText);else try{styleEl.innerHTML=cssText}catch(e){styleEl.innerText=cssText}}(),angular.module("mol-species-search-templates",[]).run(["$templateCache",function($templateCache){$templateCache.put("mol-species-search-autocomplete.html",'<script type=text/ng-template id=ac-template.html><a class="searchResult">\n\t\t<span class="sciName" ng-bind-html="match.label.scientificname | uibTypeaheadHighlight:query"></span>\n\t  <span class="commonName" ng-bind-html="((match.label.vernacular) ? match.label.vernacular : \'\') | uibTypeaheadHighlight:query"></span>\n\t</a></script><script type=text/ng-template id=popup-template.html><div class="custom-popup-wrapper">\n\t\t <ul class="dropdown-menu ng-isolate-scope"\n\t\t \t\tng-show="isOpen() && !moveInProgress"\n\t\t\t\tstyle="position:absolute;"\n\t\t\t\tng-style="{top: position().top+\'px\', right: position().right+\'px\'}"\n\t\t\t\trole="listbox" aria-hidden="false"\n\t\t\t\tuib-typeahead-popup=""\n\t\t\t\tmatches="matches" active="activeIdx"\n\t\t\t\tselect="select(activeIdx, evt)"\n\t\t\t\tmove-in-progress="moveInProgress" query="query"\n\n\t\t\t\tassign-is-open="assignIsOpen(isOpen)" debounce="debounceUpdate" template-url="ac-template.html">\n     </ul>\n  </div></script><input class=form-control style=max-width:158px autocomplete=on ng-model=selected.value placeholder="Search for a species" uib-typeahead="species.scientificname as species for species in searchSpecies(($viewValue)?$viewValue:\'.\')" typeahead-on-select=selectSpecies($model) typeahead-template-url=ac-template.html>'),$templateCache.put("mol-species-search-control.html",'<table class=search><tr><td><select style=max-width:158px;width:158px placeholder="Select a group..." class=form-control ng-model=groups.selectedIndex ng-change="groups.selected = groups.available[groups.selectedIndex].taxa"><option ng-value=null>All groups</option><option ng-value=$index ng-repeat="group in groups.available">{{group.label | capitalize}}</option></select></td></tr></table>')}]),angular.module("mol.species-search",["mol-species-search-templates"]).directive("molSpeciesSearch",function(){return{restrict:"E",scope:!1,transclude:!1,templateUrl:"mol-species-search-control.html",controller:["$scope","molApi","$state","$q","$translate","$rootScope",function($scope,molApi,$state,$q,$translate,$rootScope){var regionid=void 0;try{regionid=$scope.$parent.region.dataset_id}catch(e){}$rootScope.$on("$translateChangeSuccess",function(e){var lang=$translate.use();$scope.updateTaxa($scope.region.region_id),$scope.species.common=$scope.species.taxonomy[lang+"_name"]||$scope.species.taxonomy.en_name}),$scope.canceller=$q.defer(),$rootScope.$on("$stateChangeSuccess",function(e){$scope.selectSpecies($state.params.scientificname.replace("_"," "))}),$scope.canceller=$q.defer(),$scope.searchSpecies=function(term){return molApi({service:"species/groupsearch",params:{query:term,group:"any"!==$scope.groups.selected?$scope.groups.selected:void 0,regionid:$scope.region.region_id,lang:$translate.use()},canceller:$scope.canceller,loading:!0}).then(function(results){return results.data})},$scope.groups={available:[]},$scope.updateTaxa=function(region_id){molApi({canceller:$scope.canceller,loading:!0,service:region_id?"spatial/regions/species2":"species/availabletaxa",params:{region_id:region_id,lang:$translate.use()},creds:!0}).then(function(results){var groups=[];angular.forEach(results.data,function(result){groups.push(angular.copy(angular.extend(result,{label:result.title,value:result.taxa})))}),$scope.groups.available=groups,$scope.$parent.groups=$scope.groups})},$scope.selectSpecies=function(scientificname){""===scientificname?$scope.randomSpecies():molApi({service:"species/habitat",params:{id:scientificname,lang:$translate.use()},canceller:$scope.canceller,loading:!0}).success(function(species){if(void 0!=species){if(void 0!=species.prefs&&void 0!=species.prefs.habitats){for(var bools=[],i=0;i<17;i++)bools.push(!1);try{species.prefs.habitats.split(",").forEach(function(h){bools[parseInt(h)]=!0})}catch(e){}species.prefs.habitats=bools,100==species.prefs.tree_cover_min&&(species.prefs.tree_cover_min=50)}species.refine={},species.protect={},species.maps={},species.updateMaps=!0,species.habitat={stats:{forest_b1:void 0,forest_b0:void 0,pop_se_b1:void 0,area_se_b1:void 0,area_conf_95_10:[void 0,void 0],pop_b0:void 0,pop_conf_95_10:[void 0,void 0],area_b1:void 0,area_b0:void 0,forest_se_b1:void 0,forest_percent_change:void 0,pop_percent_change:void 0,area_percent_change:void 0,forest_conf_95_10:[void 0,void 0],pop_b1:void 0},area:[[2012,0],[2003,0],[2011,0],[2001,0],[2002,0],[2010,0],[2004,0],[2005,0],[2006,0],[2007,0],[2008,0],[2009,0]],forest:[[2012,0],[2003,0],[2011,0],[2001,0],[2002,0],[2010,0],[2004,0],[2005,0],[2006,0],[2007,0],[2008,0],[2009,0]],pop:[[2012,0],[2003,0],[2011,0],[2001,0],[2002,0],[2010,0],[2004,0],[2005,0],[2006,0],[2007,0],[2008,0],[2009,0]]},$scope.$parent.species=species}})},$scope.randomSpecies=function(){var group=null;try{group=$scope.groups.selected}catch(e){}molApi({service:"species/random",params:{taxogroup:"any"!==group?group:void 0,region_id:$scope.region.region_id,lang:$translate.use(),rand:1e6*Math.random()},canceller:$scope.canceller,loading:!0}).success(function(species){$scope.selectSpecies(species.scientificname)})},$scope.$watch("species",function(newValue,oldValue){if(newValue){var taxa=newValue.taxa||"Any group";$scope.groups.selected=taxa}}),$scope.$watch("region.region_id",function(newValue,oldValue){newValue&&$scope.updateTaxa(newValue)},!0),$scope.updateTaxa(),$state.params.scientificname?$scope.selectSpecies($state.params.scientificname.replace(/_/g," ")):$scope.randomSpecies()}]}});